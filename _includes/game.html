<section id="fun-zone" class="content-section" style="text-align: center; margin-top: 80px; padding-bottom: 40px;">
  <h2 class="section-title" style="font-size: 1.5rem; color: #555; margin-bottom: 10px;">
    ğŸ¤– å­¦æœ¯ç”Ÿå­˜æŒ‘æˆ˜
  </h2>
  <p style="font-size: 0.9rem; color: #888; margin-bottom: 15px;">
    (æŒ‰ <kbd style="background:#eee; padding:2px 5px; border-radius:3px;">ç©ºæ ¼</kbd> æˆ–ç‚¹å‡»å±å¹•è·³è·ƒï¼Œèº²é¿ DDLï¼)
  </p>
  
  <canvas id="dinoGame" width="600" height="160" style="border-bottom: 2px solid #555; background: #fafafa; max-width: 100%; touch-action: none; border-radius: 4px;"></canvas>
  
  <div style="display: flex; justify-content: space-between; max-width: 600px; margin: 10px auto; font-family: monospace; font-size: 1rem; color: #333;">
    <span>å½“å‰å¾—åˆ†: <b id="score" style="color: #007bff;">0</b></span>
    <span>æœ€é«˜è®°å½•: <b id="highScore" style="color: #c0392b;">0</b></span>
  </div>
  
  <button id="restartBtn" class="button-primary" style="display: none; margin-top: 15px; cursor: pointer;" onclick="initGame()">
    å†æ¥ä¸€æ¬¡ (Restart)
  </button>
</section>

<script>
const canvas = document.getElementById('dinoGame');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const highScoreEl = document.getElementById('highScore');
const restartBtn = document.getElementById('restartBtn');

// æ¸¸æˆé…ç½®
let gameSpeed = 5;
let score = 0;
let highScore = localStorage.getItem('dinoHighScore') || 0;
let isGameOver = false;
let animationId;
let frame = 0;

// ç©å®¶å¯¹è±¡
let player = {
    x: 50,
    y: 110,
    w: 30,
    h: 30,
    dy: 0,
    jumpPower: -10, // è·³è·ƒåŠ›åº¦
    gravity: 0.5,   // é‡åŠ› (æ”¹å°äº†ä¸€ç‚¹ï¼Œæ»ç©ºæ›´ä¹…ï¼Œæ›´ç®€å•)
    grounded: false,
    jumpCount: 0,   // å½“å‰è·³äº†å‡ æ¬¡
    maxJumps: 3     // â­ å…è®¸æœ€å¤§è·³è·ƒæ¬¡æ•° (ä¸‰è¿è·³)
};

let obstacles = [];

function initGame() {
    isGameOver = false;
    score = 0;
    gameSpeed = 5;
    obstacles = [];
    frame = 0;
    
    player.y = 110;
    player.dy = 0;
    player.jumpCount = 0; // é‡ç½®è·³è·ƒæ¬¡æ•°
    
    restartBtn.style.display = 'none';
    scoreEl.innerText = score;
    highScoreEl.innerText = highScore;
    
    animate();
}

// 1. ç»˜åˆ¶ç©å®¶ (æœºå™¨äºº -> é¬¼é­‚ -> ç«ç®­)
function drawPlayer() {
    ctx.textAlign = "left";
    ctx.textBaseline = "top";
    
    // æ ¹æ®çŠ¶æ€åˆ‡æ¢ Emoji
    let emoji = "ğŸ¤–"; // é»˜è®¤åœ°é¢çŠ¶æ€
    
    if (!player.grounded) {
        if (player.jumpCount >= 2) {
            emoji = "ğŸš€"; // äºŒæ®µ/ä¸‰æ®µè·³å˜ç«ç®­
        } else {
            emoji = "ğŸ‘»"; // ä¸€æ®µè·³å˜é¬¼é­‚
        }
    }
    
    ctx.font = "35px Arial"; 
    ctx.fillText(emoji, player.x - 2, player.y - 5); 
}

// 2. ç»˜åˆ¶éšœç¢ç‰©
function drawObstacles() {
    obstacles.forEach(obs => {
        ctx.fillStyle = '#c0392b';
        ctx.font = "bold 20px Verdana";
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillText("DDL", obs.x, obs.y + 2); 
        ctx.fillRect(obs.x, obs.y + 22, obs.w, 3);
    });
}

function update() {
    // 1. ç©å®¶ç‰©ç†
    player.dy += player.gravity;
    player.y += player.dy;

    // åœ°é¢æ£€æµ‹
    if (player.y > 110) {
        player.y = 110;
        player.dy = 0;
        player.grounded = true;
        player.jumpCount = 0; // â­ è½åœ°åé‡ç½®è·³è·ƒæ¬¡æ•°ï¼Œæ¢å¤ä¸º 0
    } else {
        player.grounded = false;
    }

    // 2. ç”Ÿæˆéšœç¢ç‰© (é—´éš”ç¨å¾®è°ƒå¤§äº†ä¸€ç‚¹ï¼Œé™ä½éš¾åº¦)
    frame++;
    let spawnRate = Math.floor(100 + Math.random() * 70); 
    if (frame % spawnRate === 0) {
        let isHigh = Math.random() > 0.75; 
        let obsY = isHigh ? 75 : 110; 
        
        obstacles.push({
            x: canvas.width,
            y: obsY,
            w: 45,
            h: 25
        });
    }

    // 3. ç§»åŠ¨éšœç¢ç‰© & ç¢°æ’
    for (let i = 0; i < obstacles.length; i++) {
        let obs = obstacles[i];
        obs.x -= gameSpeed;

        if (obs.x + obs.w < 0) {
            obstacles.splice(i, 1);
            score++;
            scoreEl.innerText = score;
            i--;
            if (score % 5 === 0) gameSpeed += 0.3; // åŠ é€Ÿç¨å¾®æ…¢ä¸€ç‚¹
        }

        // ç¢°æ’åˆ¤å®š (ç¨å¾®ç¼©å°åˆ¤å®šèŒƒå›´ï¼Œæ›´å®¹æ˜“èº²)
        let padding = 8; 
        if (
            player.x + padding < obs.x + obs.w &&
            player.x + player.w - padding > obs.x &&
            player.y + padding < obs.y + obs.h &&
            player.y + player.h - padding > obs.y
        ) {
            gameOver();
        }
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    ctx.beginPath();
    ctx.moveTo(0, 140);
    ctx.lineTo(canvas.width, 140);
    ctx.strokeStyle = "#ddd";
    ctx.stroke();

    drawPlayer();
    drawObstacles();
}

function animate() {
    if (isGameOver) return;
    update();
    draw();
    animationId = requestAnimationFrame(animate);
}

function gameOver() {
    isGameOver = true;
    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#333';
    ctx.font = "bold 30px Arial";
    ctx.textAlign = "center";
    ctx.fillText("è¢« DDL è¿½ä¸Šäº†ï¼ğŸ˜­", canvas.width / 2, canvas.height / 2 - 10);
    
    ctx.fillStyle = '#666';
    ctx.font = "16px Arial";
    ctx.fillText("å¾—åˆ†: " + score, canvas.width / 2, canvas.height / 2 + 25);
    
    restartBtn.style.display = 'inline-block';
    
    if (score > highScore) {
        highScore = score;
        localStorage.setItem('dinoHighScore', highScore);
        highScoreEl.innerText = highScore;
    }
}

// â­ æ ¸å¿ƒä¿®æ”¹ï¼šä¸‰è¿è·³é€»è¾‘
function jump() {
    // åªè¦å½“å‰è·³è·ƒæ¬¡æ•°å°äºæœ€å¤§æ¬¡æ•° (3)ï¼Œå°±å¯ä»¥è·³
    if (player.jumpCount < player.maxJumps) {
        player.dy = player.jumpPower; // ç»™ä¸€ä¸ªå‘ä¸Šçš„é€Ÿåº¦
        player.grounded = false;
        player.jumpCount++; // æ¶ˆè€—ä¸€æ¬¡è·³è·ƒæœºä¼š
    }
}

// äº‹ä»¶ç›‘å¬
document.addEventListener('keydown', function(e) {
    if (e.code === 'Space' || e.code === 'ArrowUp') {
        e.preventDefault();
        if (isGameOver) initGame();
        else jump();
    }
});

canvas.addEventListener('touchstart', function(e) {
    e.preventDefault();
    if (isGameOver) initGame();
    else jump();
}, {passive: false});

canvas.addEventListener('mousedown', function(e) {
    if (isGameOver) initGame();
    else jump();
});

// å¯åŠ¨
initGame();
</script>
